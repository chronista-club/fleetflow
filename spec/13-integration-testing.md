# Spec: 統合テストスイート

## 1. 目的 (What & Why)

FleetFlow の各コンポーネントが正しく連携し、ユーザーの意図通りにコンテナオーケストレーションが行われることを保証します。
単体テストでは捉えきれない、ファイルシステム、環境変数、Docker デーモンとの相互作用を検証します。

## 2. 検証対象ユースケース

### UC-01: プロジェクト初期化と基本操作
- **シナリオ**: 設定ファイルがない状態で `fleetflow` を実行し、初期化ウィザードを通じて `flow.kdl` を生成、その後 `up` が成功することを確認。
- **期待結果**: 正しいディレクトリ構造でファイルが作成され、ダミーのコンテナが起動する。

### UC-02: ワークロードによる暗黙的インクルード
- **シナリオ**: `workload` 宣言を含む `flow.kdl` を用意し、`workloads/` ディレクトリ配下の設定が正しくマージされることを確認。
- **期待結果**: ワークロードで定義されたサービスが `flow ps` に現れる。

### UC-03: ステージのライフサイクル（作成・更新・削除）
- **作成 (Up)**: `flow.kdl` で定義した新規ステージに対して `flow up` を実行し、期待通りコンテナが作成されることを確認。
- **更新 (Update)**: `flow.kdl` のステージ定義（ポートや環境変数）を変更して再度 `up` を実行し、既存コンテナが更新（再起動等）されることを確認。
- **削除 (Down/Remove)**: `flow down --remove` を実行し、コンテナおよびネットワークが削除されることを確認。

### UC-04: 設定のオーバーライド
- **シナリオ**: `flow.kdl` と `flow.local.kdl` を用意し、ローカル設定が優先されることを確認。
- **期待結果**: `flow.local.kdl` で指定したイメージや変数が反映される。

## 3. 成功基準
- `cargo test` で全てのユースケースが自動実行され、パスすること。
- テスト実行後に、テストによって作成された一時ファイルやコンテナがクリーンアップされていること。
