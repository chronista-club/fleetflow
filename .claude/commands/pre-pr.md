# Pre-PR チェックフロー

プルリクエストを作成する前に、以下のチェックを順番に実行してください:

## 1. フォーマットチェック

```bash
cargo fmt --all -- --check
```

フォーマットエラーがある場合:
- `cargo fmt --all` で自動整形
- 整形されたファイルを確認
- コミットしてから次のステップへ

## 2. テスト実行

```bash
cargo test --all
```

テストが失敗した場合:
- エラー内容を分析
- 修正が必要な箇所を特定
- テストをパスするまで修正

## 3. Clippy (リンティング)

```bash
cargo clippy --all -- -D warnings
```

警告がある場合:
- 各警告を確認
- 修正が必要なものを修正
- 警告がゼロになるまで対応

## 4. ドキュメント更新の確認

変更されたコードファイルに対して、関連するドキュメントの更新が必要か確認:

- `design/` - 設計書の更新が必要か？
- `spec/` - 仕様書の更新が必要か？
- `.claude/CLAUDE.md` - プロジェクト概要の更新が必要か？
- `README.md` - 使い方の更新が必要か？

`git diff main --name-only` で変更ファイルを確認して、対応するドキュメントをチェック。

## 5. 変更サマリーの生成

以下を確認:
- `git log main..HEAD --oneline` - コミット履歴
- `git diff main --stat` - 変更統計
- `git diff main` - 実際の変更内容

変更内容をレビューして、PR本文に含める情報を整理:
- 何を実装したか
- なぜこの実装が必要か
- 技術的なポイント
- テストカバレッジ
- 関連Issue

## 6. PR作成

すべてのチェックがパスした場合のみ、以下のコマンドでPRを作成:

```bash
gh pr create --title "タイトル" --body "$(cat <<'EOF'
## 概要

変更内容のサマリー

## 実装内容

- 実装した機能1
- 実装した機能2

## テスト

- テストケース数: XX件
- カバレッジ: 追加テストXX件

## 関連Issue

Closes #XX

🤖 Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

## チェックリスト

実行前に以下を確認:
- [ ] 現在のブランチがfeatureブランチである
- [ ] mainブランチから最新の変更をpullしている
- [ ] コミットメッセージが適切である
- [ ] すべてのファイルがコミットされている

---

**重要**: このチェックフローをすべて完了してからPRを作成することで、CI失敗を防ぎ、レビュー品質を向上させます。
